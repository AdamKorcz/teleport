
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to install and configure Gravitational Teleport on GCP for SSH and Kubernetes access.">
      
      
        <link rel="canonical" href="https://gravitational.com/teleport/docs/gcp-guide/">
      
      
        <meta name="author" content="Gravitational Inc">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.2+insiders-1.7.0">
    
    
      
        <title>Running Teleport on GCP - Gravitational Teleport</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.b0e00042.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f0267088.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../css/version-select.css">
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
      <script>var palette=JSON.parse(localStorage.getItem("__palette")||"{}");if(void 0!==palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-teleport-on-gcp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://gravitational.com/teleport/docs" title="Gravitational Teleport" class="md-header-nav__button md-logo" aria-label="Gravitational Teleport">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Gravitational Teleport
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Running Teleport on GCP
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header-nav__options">
      
        
          
          
          
          <button class="md-header-nav__button md-icon" title="Switch to light mode" aria-label="Switch to light mode" data-md-option="palette" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 00-5 5 5 5 0 005 5h10a5 5 0 005-5 5 5 0 00-5-5m0 8a3 3 0 01-3-3 3 3 0 013-3 3 3 0 013 3 3 3 0 01-3 3z"/></svg>
          </button>
        
          
          
          
          <button class="md-header-nav__button md-icon" title="Switch to dark mode" aria-label="Switch to dark mode" data-md-option="palette" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2 2 2 0 012-2m10-3a5 5 0 015 5 5 5 0 01-5 5H7a5 5 0 01-5-5 5 5 0 015-5h10M7 9a3 3 0 00-3 3 3 3 0 003 3h10a3 3 0 003-3 3 3 0 00-3-3H7z"/></svg>
          </button>
        
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
      <div class="md-search__suggest" data-md-component="search-suggest"></div>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/gravitational/teleport/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://gravitational.com/teleport/docs" title="Gravitational Teleport" class="md-nav__button md-logo" aria-label="Gravitational Teleport">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Gravitational Teleport
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/gravitational/teleport/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Documentation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Documentation" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quickstart/" class="md-nav__link">
      Quick Start Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user-manual/" class="md-nav__link">
      User Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../admin-guide/" class="md-nav__link">
      Admin Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../production/" class="md-nav__link">
      Production Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../faq/" class="md-nav__link">
      FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Infrastructure Guides
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Infrastructure Guides" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Infrastructure Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws-oss-guide/" class="md-nav__link">
      AWS
    </a>
  </li>

        
          
          
          


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      AWS Terraform
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="AWS Terraform" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon"></span>
        AWS Terraform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws-terraform-guide/" class="md-nav__link">
      AWS Terraform
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        GCP
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      GCP
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#teleport-on-gcp-faq" class="md-nav__link">
    Teleport on GCP FAQ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-teleport-introduction" class="md-nav__link">
    GCP Teleport Introduction
  </a>
  
    <nav class="md-nav" aria-label="GCP Teleport Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compute-engine-vm-instances-with-instance-groups" class="md-nav__link">
    Compute Engine: VM Instances with Instance Groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computer-engine-health-checks" class="md-nav__link">
    Computer Engine: Health Checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-cloud-firestore" class="md-nav__link">
    Storage: Cloud Firestore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-google-cloud-storage" class="md-nav__link">
    Storage: Google Cloud Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-services-load-balancing" class="md-nav__link">
    Network Services: Load Balancing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-services-cloud-dns" class="md-nav__link">
    Network Services: Cloud DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-service-accounts" class="md-nav__link">
    Access: Service accounts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-quickstart" class="md-nav__link">
    GCP Quickstart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-create-resources" class="md-nav__link">
    1. Create Resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-install-configure-teleport" class="md-nav__link">
    2. Install &amp; Configure Teleport
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ibm-cloud-guide/" class="md-nav__link">
      IBM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubernetes-ssh/" class="md-nav__link">
      Kubernetes Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openssh-teleport/" class="md-nav__link">
      OpenSSH Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Teleport Enterprise
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Teleport Enterprise" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Teleport Enterprise
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/introduction/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/quickstart-enterprise/" class="md-nav__link">
      Quick Start Guide
    </a>
  </li>

        
          
          
          


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Single sign-on (SSO)
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Single sign-on (SSO)" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        <span class="md-nav__icon md-icon"></span>
        Single sign-on (SSO)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/sso/ssh-sso/" class="md-nav__link">
      SSO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/sso/ssh-azuread/" class="md-nav__link">
      Azure Active Directory (AD)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/sso/ssh-adfs/" class="md-nav__link">
      Active Directory (ADFS)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/sso/ssh-gsuite/" class="md-nav__link">
      G Suite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/sso/ssh-one-login/" class="md-nav__link">
      OneLogin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/sso/oidc/" class="md-nav__link">
      OIDC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/sso/ssh-okta/" class="md-nav__link">
      Okta
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/workflow/" class="md-nav__link">
      Approval Workflow
    </a>
  </li>

        
          
          
          


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Teleport Plugins
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Teleport Plugins" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        <span class="md-nav__icon md-icon"></span>
        Teleport Plugins
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/workflow/ssh-approval-jira-cloud/" class="md-nav__link">
      Teleport  Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/workflow/ssh-approval-jira-server/" class="md-nav__link">
      Teleport Jira Server Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/workflow/ssh-approval-mattermost/" class="md-nav__link">
      Teleport Mattermost Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/workflow/ssh-approval-pagerduty/" class="md-nav__link">
      Teleport Pagerduty Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/workflow/ssh-approval-slack/" class="md-nav__link">
      Teleport Slack Plugin Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/ssh-kubernetes-fedramp/" class="md-nav__link">
      FedRAMP for SSH & K8s
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enterprise/ssh-rbac/" class="md-nav__link">
      RBAC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Architecture
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/overview/" class="md-nav__link">
      Architecture Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/users/" class="md-nav__link">
      Teleport Users
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/nodes/" class="md-nav__link">
      Teleport Nodes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/authentication/" class="md-nav__link">
      Teleport Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/proxy/" class="md-nav__link">
      Teleport Proxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../trustedclusters/" class="md-nav__link">
      Trusted Clusters
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Advanced Features
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Advanced Features" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Advanced Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../features/enhanced-session-recording/" class="md-nav__link">
      Enhanced Session Rec.
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../features/ssh-pam/" class="md-nav__link">
      Using Teleport with PAM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../config-reference/" class="md-nav__link">
      YAML
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli-docs/" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-reference/" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../metrics-logs-reference/" class="md-nav__link">
      Metrics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              
                
              
              
                <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                  <div class="md-sidebar__scrollwrap">
                    <div class="md-sidebar__inner">
                      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#teleport-on-gcp-faq" class="md-nav__link">
    Teleport on GCP FAQ
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-teleport-introduction" class="md-nav__link">
    GCP Teleport Introduction
  </a>
  
    <nav class="md-nav" aria-label="GCP Teleport Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compute-engine-vm-instances-with-instance-groups" class="md-nav__link">
    Compute Engine: VM Instances with Instance Groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computer-engine-health-checks" class="md-nav__link">
    Computer Engine: Health Checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-cloud-firestore" class="md-nav__link">
    Storage: Cloud Firestore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-google-cloud-storage" class="md-nav__link">
    Storage: Google Cloud Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-services-load-balancing" class="md-nav__link">
    Network Services: Load Balancing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-services-cloud-dns" class="md-nav__link">
    Network Services: Cloud DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-service-accounts" class="md-nav__link">
    Access: Service accounts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-quickstart" class="md-nav__link">
    GCP Quickstart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-create-resources" class="md-nav__link">
    1. Create Resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-install-configure-teleport" class="md-nav__link">
    2. Install &amp; Configure Teleport
  </a>
  
</li>
      
    </ul>
  
</nav>
                    </div>
                  </div>
                </div>
              
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/gravitational/teleport/edit/master/docs/gcp-guide.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="running-teleport-on-gcp">Running Teleport on GCP</h1>
<p>We've created this guide to give customers a high level overview of how to use Teleport
on <a href="https://cloud.google.com/gcp/">Google Cloud</a> (GCP). This guide provides a high level
introduction leading to a deep dive into how to setup and run Teleport in production.</p>
<p>We have split this guide into:</p>
<ul>
<li><a href="#teleport-on-gcp-faq">Teleport on GCP FAQ</a></li>
<li><a href="#gcp-teleport-introduction">GCP Teleport Introduction</a></li>
<li><a href="#gcp-quickstart">GCP Quickstart</a></li>
</ul>
<h2 id="teleport-on-gcp-faq">Teleport on GCP FAQ</h2>
<h4>Why would you want to use Teleport with GCP?</h4>
<p>As leader in <a href="https://cloud.google.com/beyondcorp/">BeyondCorp</a>, GCP already provides
some great tools out of the box such as <a href="https://cloud.google.com/iap/">Cloud Identity-Aware Proxy</a>.
This is an excellent tool to quickly get setup securely with GCP but it can become
complicated to integrate into existing workflows and complicated if you want to share
tool across clouds.</p>
<h4>Which Services can I use Teleport with?</h4>
<p>You can use Teleport for all the services that you would SSH into. This guide is
focused on Google Compute Engine. In the future we'll plan to update on how to use
Teleport with Google Kubernetes Engine (GKE).</p>
<h2 id="gcp-teleport-introduction">GCP Teleport Introduction</h2>
<p>This guide will cover how to setup, configure and run Teleport on GCP.</p>
<p>GCP Services required to run Teleport in HA:</p>
<ul>
<li><a href="#compute-engine-vm-instances-with-instance-groups">Compute Engine: VM Instances with Instance Groups</a></li>
<li><a href="#computer-engine-health-checks">Computer Engine: Health Checks</a></li>
<li><a href="#storage-google-cloud-storage">Storage: Cloud Firestore</a></li>
<li><a href="#storage-google-cloud-storage">Storage: Google Cloud Storage</a></li>
<li><a href="#network-services-load-balancing">Network Services: Load Balancing</a></li>
<li><a href="#network-services-cloud-dns">Network Services: Cloud DNS</a></li>
</ul>
<p>Other things needed:</p>
<ul>
<li><a href="https://cloud.google.com/load-balancing/docs/ssl-certificates">SSL Certificate</a></li>
</ul>
<p>Optional:</p>
<ul>
<li>Management Tools: Cloud Deployment Manager</li>
<li>Stackdriver Logging</li>
</ul>
<p>We recommend setting up Teleport in high availability mode (HA). In HA mode Firestore
stores the state of the system and Google Cloud Storage stores the audit logs.</p>
<p><img alt="GCP Intro Image" src="../img/gcp/gcp-teleport.svg" /></p>
<h3 id="compute-engine-vm-instances-with-instance-groups">Compute Engine: VM Instances with Instance Groups</h3>
<p>To run Teleport in a HA configuration we recommend using <code>n1-standard-2</code> instances in
Production. It's best practice to separate the proxy and authentication server, using
Instance groups for the proxy and auth server.</p>
<h3 id="computer-engine-health-checks">Computer Engine: Health Checks</h3>
<p>GCP relies heavily on <a href="https://cloud.google.com/load-balancing/docs/health-checks">Health Checks</a>,
this is helpful when adding new instances to an instance group.</p>
<p>To enable health checks in Teleport start with <code>teleport start --diag-addr=0.0.0.0:3000</code>
see  <a href="../admin-guide/#troubleshooting">Admin Guide: Troubleshooting</a> for more information.</p>
<h3 id="storage-cloud-firestore">Storage: Cloud Firestore</h3>
<p><a href="https://cloud.google.com/firestore/">Cloud Firestore</a> This storage backend uses real-time
updates to keep individual auth instances in sync and requires Firestore configured
in native mode.</p>
<p>Add this storage configuration in teleport section of the config file (by default it's <code>/etc/teleport.yaml</code>):</p>
<div class="highlight"><pre><span></span><code><span class="nt">teleport</span><span class="p">:</span>
  <span class="nt">storage</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">firestore</span>
    <span class="nt">collection_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-data</span>
    <span class="nt">project_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EXAMPLE_gcp-proj-with-firestore-enabled</span>
    <span class="nt">credentials_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/teleport/firestore_creds.json</span>
    <span class="nt">audit_events_uri</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;firestore://events_table_name&#39;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<h3 id="storage-google-cloud-storage">Storage: Google Cloud Storage</h3>
<p>When creating the Bucket we would recommend setting it up as <code>Dual-region</code> and with
<code>Standard</code> storage class. Provide access using a <code>Uniform</code> access control with a Google-managed
key.</p>
<p>When setting up <code>audit_session_uri</code> use <code>gs://</code> session prefix.</p>
<div class="highlight"><pre><span></span><code><span class="nt">storage</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">audit_sessions_uri</span><span class="p p-Indicator">:</span> <span class="s">&#39;gs://teleport-session-storage-2?credentialsPath=/var/lib/teleport/gcs_creds.json&amp;projectID=EXAMPLE_gcp-proj-with-firestore-enabled&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>
<h3 id="network-services-load-balancing">Network Services: Load Balancing</h3>
<p>Load Balancing is required for Proxy and SSH traffic. Use <code>TCP Load Balancing</code> as
Teleport requires custom ports for SSH and Web Traffic.</p>
<h3 id="network-services-cloud-dns">Network Services: Cloud DNS</h3>
<p>Cloud DNS is used to setup the public URL of the Teleport Proxy. Once setup an <code>A</code>
record is sufficient.</p>
<h3 id="access-service-accounts">Access: Service accounts</h3>
<p>The Authentication server will need to read and write to Firestore.  For this it'll need
the correct permission via Server Accounts. Learn how to <a href="https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances">enable and create service accounts for instances</a>.</p>
<p><img alt="Service Account" src="../img/gcp/gcp-permissions.png" /></p>
<p><strong>Download JSON Service Key</strong>
<img alt="GCP Service Key" src="../img/gcp/gcp-service-key.png" /></p>
<h2 id="gcp-quickstart">GCP Quickstart</h2>
<h2 id="1-create-resources">1. Create Resources</h2>
<p>We recommend starting by creating the resources. We highly recommend creating these
an infrastructure automation tool such as <a href="https://cloud.google.com/deployment-manager/">Cloud Deployment Manager</a> or Terraform.</p>
<h2 id="2-install-configure-teleport">2. Install &amp; Configure Teleport</h2>
<p>Follow install instructions from our <a href="../installation/#linux">installation page</a>.</p>
<p>We recommend configuring Teleport as per the below steps:</p>
<p><strong>1. Configure Teleport Auth Server</strong> using the below example <code>teleport.yaml</code>, and start it
using <a href="https://raw.githubusercontent.com/gravitational/teleport/master/examples/systemd/teleport.service">systemd</a> or use DEB/.RPM packages available from our <a href="https://gravitational.com/teleport/download/">Downloads Page</a>.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#</span>
<span class="c1"># Sample Teleport configuration teleport.yaml file for Auth Server</span>
<span class="c1">#</span>
<span class="nt">teleport</span><span class="p">:</span>
  <span class="nt">nodename</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">teleport-auth-server</span>
  <span class="nt">data_dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/teleport</span>
  <span class="nt">pid_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/run/teleport.pid</span>
  <span class="nt">auth_token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EXAMPLE-CLUSTER-JOIN-TOKEN</span>
  <span class="nt">auth_servers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0:3025</span>
  <span class="nt">connection_limits</span><span class="p">:</span>
    <span class="nt">max_connections</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15000</span>
    <span class="nt">max_users</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">250</span>
  <span class="nt">log</span><span class="p">:</span>
    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stderr</span>
    <span class="nt">severity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
  <span class="nt">storage</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">firestore</span>
    <span class="nt">collection_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-data</span>
    <span class="c1"># Credentials: Path to google service account file, used for Firestore and Google Storage.</span>
    <span class="nt">credentials_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/teleport/gcs_creds.json</span>
    <span class="nt">project_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example_Teleport-Project-Name</span>
    <span class="nt">audit_events_uri</span><span class="p">:</span> <span class="s">&#39;firestore://events?projectID=example_Teleport-Project-Name&amp;credentialsPath=/var/lib/teleport/gcs_creds&#39;</span>
    <span class="nt">audit_sessions_uri</span><span class="p">:</span> <span class="s">&#39;gs://teleport-session-storage-2?credentialsPath=/var/lib/teleport/gcs_creds.json&amp;projectID=example_Teleport-Project-Name&#39;</span>
<span class="nt">auth_service</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="nt">auth_service</span><span class="p">:</span>
    <span class="nt">tokens</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;proxy,node:EXAMPLE-CLUSTER-JOIN-TOKEN&quot;</span>
</code></pre></div>
<p><strong>2. Setup Proxy</strong></p>
<p>Save the following configuration file as <code>/etc/teleport.yaml</code> on the Proxy Server:</p>
<div class="highlight"><pre><span></span><code><span class="nt">teleport</span><span class="p">:</span>
  <span class="nt">auth_token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EXAMPLE-CLUSTER-JOIN-TOKEN</span>
  <span class="c1"># We recommend using a TCP load balancer pointed to the auth servers when</span>
  <span class="c1"># setting up in HA mode.</span>
  <span class="nt">auth_servers</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;auth.example.com:3025&quot;</span> <span class="p p-Indicator">]</span>
  <span class="c1"># enable ssh service and disable auth and proxy:</span>
<span class="nt">ssh_service</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">auth_service</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">proxy_service</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<p><strong>3. Setup Teleport Nodes</strong></p>
<p>Save the following configuration file as <code>/etc/teleport.yaml</code> on the node:</p>
<div class="highlight"><pre><span></span><code><span class="nt">teleport</span><span class="p">:</span>
  <span class="nt">auth_token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EXAMPLE-CLUSTER-JOIN-TOKEN</span>
  <span class="c1"># We recommend using a TCP load balancer pointed to the auth servers when</span>
  <span class="c1"># setting up in HA mode.</span>
  <span class="nt">auth_servers</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;auth.example.com:3025&quot;</span> <span class="p p-Indicator">]</span>
  <span class="c1"># enable ssh service and disable auth and proxy:</span>
<span class="nt">ssh_service</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">auth_service</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">proxy_service</span><span class="p">:</span>
  <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<p><strong>4. Add Users</strong></p>
<p>Follow <a href="../enterprise/quickstart-enterprise/#adding-users">adding users</a> or integrate with <a href="../enterprise/sso/ssh-gsuite/">G Suite</a> to provide SSO access.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../aws-terraform-guide/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                AWS Terraform
              </div>
            </div>
          </a>
        
        
          <a href="../ibm-cloud-guide/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                IBM
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Gravitational Inc, 2016-20
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material-insiders/" target="_blank" rel="noopener">
            Material for MkDocs Insiders
          </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../assets/javascripts/bundle.d964fd3f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.0f64ce30.min.js"
          }, typeof search !== "undefined" && search),
          version: {'method': 'mike'}
        })
      </script>
      
        <script src="../js/version-select.js"></script>
      
    
  </body>
</html>