
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to configure SSH access with Google Apps (also known as G Suite) using Teleport">
      
      
        <link rel="canonical" href="https://gravitational.com/teleport/docs/enterprise/sso/ssh-gsuite/">
      
      
        <meta name="author" content="Gravitational Inc">
      
      <link rel="shortcut icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.2+insiders-1.7.0">
    
    
      
        <title>SSH Authentication With Google Apps (G Suite) - Gravitational Teleport</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.b0e00042.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.f0267088.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../css/version-select.css">
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
      <script>var palette=JSON.parse(localStorage.getItem("__palette")||"{}");if(void 0!==palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ssh-authentication-with-g-suite-google-apps" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://gravitational.com/teleport/docs" title="Gravitational Teleport" class="md-header-nav__button md-logo" aria-label="Gravitational Teleport">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Gravitational Teleport
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              SSH Authentication With Google Apps (G Suite)
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header-nav__options">
      
        
          
          
          
          <button class="md-header-nav__button md-icon" title="Switch to light mode" aria-label="Switch to light mode" data-md-option="palette" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 00-5 5 5 5 0 005 5h10a5 5 0 005-5 5 5 0 00-5-5m0 8a3 3 0 01-3-3 3 3 0 013-3 3 3 0 013 3 3 3 0 01-3 3z"/></svg>
          </button>
        
          
          
          
          <button class="md-header-nav__button md-icon" title="Switch to dark mode" aria-label="Switch to dark mode" data-md-option="palette" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2 2 2 0 012-2m10-3a5 5 0 015 5 5 5 0 01-5 5H7a5 5 0 01-5-5 5 5 0 015-5h10M7 9a3 3 0 00-3 3 3 3 0 003 3h10a3 3 0 003-3 3 3 0 00-3-3H7z"/></svg>
          </button>
        
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
      <div class="md-search__suggest" data-md-component="search-suggest"></div>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/gravitational/teleport/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://gravitational.com/teleport/docs" title="Gravitational Teleport" class="md-nav__button md-logo" aria-label="Gravitational Teleport">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Gravitational Teleport
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/gravitational/teleport/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Documentation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Documentation" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installation/" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quickstart/" class="md-nav__link">
      Quick Start Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../user-manual/" class="md-nav__link">
      User Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin-guide/" class="md-nav__link">
      Admin Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../production/" class="md-nav__link">
      Production Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/" class="md-nav__link">
      FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Infrastructure Guides
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Infrastructure Guides" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Infrastructure Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws-oss-guide/" class="md-nav__link">
      AWS
    </a>
  </li>

        
          
          
          


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      AWS Terraform
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="AWS Terraform" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon"></span>
        AWS Terraform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../aws-terraform-guide/" class="md-nav__link">
      AWS Terraform
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gcp-guide/" class="md-nav__link">
      GCP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ibm-cloud-guide/" class="md-nav__link">
      IBM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../kubernetes-ssh/" class="md-nav__link">
      Kubernetes Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../openssh-teleport/" class="md-nav__link">
      OpenSSH Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Teleport Enterprise
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Teleport Enterprise" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Teleport Enterprise
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../quickstart-enterprise/" class="md-nav__link">
      Quick Start Guide
    </a>
  </li>

        
          
          
          

  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3" checked>
    
    <label class="md-nav__link" for="nav-3-3">
      Single sign-on (SSO)
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Single sign-on (SSO)" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        <span class="md-nav__icon md-icon"></span>
        Single sign-on (SSO)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh-sso/" class="md-nav__link">
      SSO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh-azuread/" class="md-nav__link">
      Azure Active Directory (AD)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh-adfs/" class="md-nav__link">
      Active Directory (ADFS)
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        G Suite
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      G Suite
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#google-apps-as-sso-for-ssh" class="md-nav__link">
    Google Apps as SSO for SSH
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-g-suite" class="md-nav__link">
    Configure G Suite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-service-account" class="md-nav__link">
    Create a Service Account
  </a>
  
    <nav class="md-nav" aria-label="Create a Service Account">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-account-delegation" class="md-nav__link">
    Enable Account Delegation:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-service-account-json" class="md-nav__link">
    Download Service Account JSON
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage-api-scopes" class="md-nav__link">
    Manage API Scopes:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-oidc-connector" class="md-nav__link">
    Create a OIDC Connector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-teleport-roles" class="md-nav__link">
    Create Teleport Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh-one-login/" class="md-nav__link">
      OneLogin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../oidc/" class="md-nav__link">
      OIDC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh-okta/" class="md-nav__link">
      Okta
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workflow/" class="md-nav__link">
      Approval Workflow
    </a>
  </li>

        
          
          
          


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Teleport Plugins
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Teleport Plugins" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        <span class="md-nav__icon md-icon"></span>
        Teleport Plugins
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workflow/ssh-approval-jira-cloud/" class="md-nav__link">
      Teleport  Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workflow/ssh-approval-jira-server/" class="md-nav__link">
      Teleport Jira Server Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workflow/ssh-approval-mattermost/" class="md-nav__link">
      Teleport Mattermost Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workflow/ssh-approval-pagerduty/" class="md-nav__link">
      Teleport Pagerduty Plugin Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workflow/ssh-approval-slack/" class="md-nav__link">
      Teleport Slack Plugin Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ssh-kubernetes-fedramp/" class="md-nav__link">
      FedRAMP for SSH & K8s
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ssh-rbac/" class="md-nav__link">
      RBAC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Architecture
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Architecture" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/overview/" class="md-nav__link">
      Architecture Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/users/" class="md-nav__link">
      Teleport Users
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/nodes/" class="md-nav__link">
      Teleport Nodes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/authentication/" class="md-nav__link">
      Teleport Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/proxy/" class="md-nav__link">
      Teleport Proxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../trustedclusters/" class="md-nav__link">
      Trusted Clusters
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Advanced Features
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Advanced Features" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Advanced Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/enhanced-session-recording/" class="md-nav__link">
      Enhanced Session Rec.
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/ssh-pam/" class="md-nav__link">
      Using Teleport with PAM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../config-reference/" class="md-nav__link">
      YAML
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cli-docs/" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api-reference/" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../metrics-logs-reference/" class="md-nav__link">
      Metrics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              
                
              
              
                <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                  <div class="md-sidebar__scrollwrap">
                    <div class="md-sidebar__inner">
                      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#google-apps-as-sso-for-ssh" class="md-nav__link">
    Google Apps as SSO for SSH
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-g-suite" class="md-nav__link">
    Configure G Suite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-service-account" class="md-nav__link">
    Create a Service Account
  </a>
  
    <nav class="md-nav" aria-label="Create a Service Account">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-account-delegation" class="md-nav__link">
    Enable Account Delegation:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-service-account-json" class="md-nav__link">
    Download Service Account JSON
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage-api-scopes" class="md-nav__link">
    Manage API Scopes:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-oidc-connector" class="md-nav__link">
    Create a OIDC Connector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-teleport-roles" class="md-nav__link">
    Create Teleport Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
      
    </ul>
  
</nav>
                    </div>
                  </div>
                </div>
              
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/gravitational/teleport/edit/master/docs/enterprise/sso/ssh-gsuite.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="ssh-authentication-with-g-suite-google-apps">SSH Authentication with G Suite (Google Apps)</h1>
<h2 id="google-apps-as-sso-for-ssh">Google Apps as SSO for SSH</h2>
<p>This guide will cover how to configure <a href="https://gsuite.google.com">G Suite</a> to be a
single sign-on (SSO) provider to issue SSH credentials to specific groups of users.
When used in combination with role based access control (RBAC) it allows SSH administrators
to define policies like:</p>
<ul>
<li>Only members of "DBA" Google group can SSH into machines running PostgreSQL.</li>
<li>Developers must never SSH into production servers.</li>
<li>... and many others.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Version Warning</p>
<p>This guide requires an enterprise version of Teleport 4.1.4 or greater. The open source
edition of Teleport only supports <a href="../../../admin-guide/#github-oauth-20">Github</a> as
an SSO provider.</p>
</div>
<iframe width="712" height="400" src="https://www.youtube.com/embed/DG97l8WJ6oU?rel=0&modestbranding=1&widget_referrer=gravitational.com/teleport/docs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h2 id="prerequisites">Prerequisites:</h2>
<p>Before you get started you’ll need:</p>
<ul>
<li>An Enterprise version of Teleport v4.1.4 or greater, downloaded from <a href="https://dashboard.gravitational.com/web/login">https://dashboard.gravitational.com/</a>.</li>
<li>Be a G Suite Super Admin. As Google Best Practices, we would recommend setting up a seperate super admin with 2FA vs using your user.<ul>
<li>e.g. A dedicated account ben-ops@practice.io vs my daily ben@practice.io</li>
</ul>
</li>
<li>Ability to create GCP Project.<ul>
<li>This might require signing up to GCP, but for this project it won’t require using any paid services. It’s just a side effect of G Suite and GCP being closely related.</li>
</ul>
</li>
<li>Have a <a href="https://support.google.com/a/answer/60216?hl=en">verified Domain</a>.</li>
<li>Ability to Setup G Suite Groups</li>
</ul>
<h2 id="configure-g-suite">Configure G Suite</h2>
<ol>
<li>
<p>Obtain OAuth 2.0 credentials  <a href="https://developers.google.com/identity/protocols/OpenIDConnect">https://developers.google.com/identity/protocols/OpenIDConnect</a></p>
</li>
<li>
<p>Create a new Project.
<img alt="Create New Project" src="../../../img/gsuite/gsuite-1-new-project.png" /></p>
</li>
<li>
<p>Select OAuth client ID.
<img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-2-created-creds.png" /></p>
</li>
<li>
<p>Make Application Type Public &amp; Setup Domain Verification
<img alt="Setup Application Type" src="../../../img/gsuite/gsuite-3-oauth.png" /></p>
</li>
<li>
<p>Copy OAuth Client ID and Client Secret for YAML Below.
   Note: The redirect_url: <code>https://teleport.example.com:3080/v1/webapi/oidc/callback</code></p>
</li>
</ol>
<p><img alt="Copy Client Secret" src="../../../img/gsuite/gsuite-5-copy-client-id.png" /></p>
<h2 id="create-a-service-account">Create a Service Account</h2>
<p><img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-5a-service-account.png" />
Leave Service account users roles, and admin roles as blank.
<img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-5b-service-account.png" />
Leave Service account permissions as blank.
<img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-5c-service-account.png" /></p>
<h3 id="enable-account-delegation">Enable Account Delegation:</h3>
<p><img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-5d-service-account-delegation.png" />
<img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-5e-enable-delegation.png" /></p>
<h3 id="download-service-account-json">Download Service Account JSON</h3>
<p><img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-5f-download-json.png" /></p>
<p>This JSON file will need to be uploaded to the Authentication server, and will be later referenced by
the OIDC Connector, under <code>google_service_account_uri</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Teleport requires the service account JSON to be uploaded to all Teleport authentication servers when setting
up in a HA config.</p>
</div>
<h2 id="manage-api-scopes">Manage API Scopes:</h2>
<p>Before setting the Manage API client access capture the client ID of the service account.</p>
<p>Within GSuite to access the Manage API client access go to Security -&gt; Settings.  Navigate to Advanced Settings and open Manage API client access.  Put the client ID in the Client Name field and the below permissions in the API scopes as a single comma separated line.  Press Authorize.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not use the email of the service account. The configuration display will look the same but the service account will not have the domain-wide delegation required. The <code>client_id</code> field must be the unique ID number captured from the admin UI. An indicator that this is misconfigured is if you see "Client is unauthorized to retrieve access tokens using this method, or client not authorized for any of the scopes requested." in your log.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>The email that you set for <code>google_admin_email</code> <strong>must</strong> be the email address of a user that has permission to list all groups, users, and group membership in your G Suite account. This user will generally need super admin privileges.</p>
<p><strong>Client Name:</strong> For Client Name: Use the Unique ID for the service account.  <a href="https://youtu.be/DG97l8WJ6oU?t=281">See Video for instructions</a>.</p>
<p><strong>API Scopes:</strong> Copy these three API Scopes.</p>
<div class="highlight"><pre><span></span><code>https://www.googleapis.com/auth/admin.directory.group.member.readonly, https://www.googleapis.com/auth/admin.directory.group.readonly, https://www.googleapis.com/auth/admin.directory.user.readonly
</code></pre></div>
<p><img alt="Create OAuth Creds" src="../../../img/gsuite/gsuite-6a-manage-access.png" /></p>
<h2 id="create-a-oidc-connector">Create a OIDC Connector</h2>
<p>Now, create a OIDC connector <a href="../../../admin-guide/#resources">resource</a>.
Write down this template as <code>gsuite-connector.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">{</span><span class="kt">!examples/resources/gsuite-connector.yaml!</span><span class="p p-Indicator">}</span>
</code></pre></div>
<p>Create the connector using <code>tctl</code> tool:</p>
<div class="highlight"><pre><span></span><code>$ tctl create gsuite-connector.yaml
</code></pre></div>
<h2 id="create-teleport-roles">Create Teleport Roles</h2>
<p>We are going to create 2 roles:</p>
<ul>
<li>Privileged role admin who is able to login as root and is capable of administrating
the cluster</li>
<li>Non-privileged dev</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">role</span>
<span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v3</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">options</span><span class="p">:</span>
    <span class="nt">max_session_ttl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">24h</span>
  <span class="nt">allow</span><span class="p">:</span>
    <span class="nt">logins</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">root</span><span class="p p-Indicator">]</span>
    <span class="nt">node_labels</span><span class="p">:</span>
      <span class="s">&quot;*&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;*&quot;</span>
    <span class="nt">rules</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
        <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Devs are only allowed to login to nodes labelled with <code>access: relaxed</code>
Teleport label. Developers can log in as either <code>ubuntu</code> or a username that
arrives in their assertions. Developers also do not have any rules needed to
obtain admin access to Teleport.</p>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">role</span>
<span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v3</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">options</span><span class="p">:</span>
    <span class="nt">max_session_ttl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">24h</span>
  <span class="nt">allow</span><span class="p">:</span>
    <span class="nt">logins</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="s">&quot;{%</span><span class="nv"> </span><span class="s">raw</span><span class="nv"> </span><span class="s">%}{{external.username}}{%</span><span class="nv"> </span><span class="s">endraw</span><span class="nv"> </span><span class="s">%}&quot;</span><span class="p p-Indicator">,</span> <span class="nv">ubuntu</span> <span class="p p-Indicator">]</span>
    <span class="nt">node_labels</span><span class="p">:</span>
      <span class="nt">access</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">relaxed</span>
</code></pre></div>
<p><strong>Notice:</strong> Replace <code>ubuntu</code> with linux login available on your servers!</p>
<div class="highlight"><pre><span></span><code>$ tctl create admin.yaml
$ tctl create dev.yaml
</code></pre></div>
<h2 id="testing">Testing</h2>
<p>The Web UI will now contain a new button: "Login with GSuite". The CLI is
the same as before:</p>
<div class="highlight"><pre><span></span><code>$ tsh --proxy=proxy.example.com login
</code></pre></div>
<p>This command will print the SSO login URL (and will try to open it
automatically in a browser).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Teleport can use multiple OIDC connectors. In this case a connector name
can be passed via <code>tsh login --auth=gsuite</code></p>
</div>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If you get "access denied" errors the number one place to check is the audit
log on the Teleport auth server. It is located in <code>/var/lib/teleport/log</code> by
default and it will contain the detailed reason why a user's login was denied.</p>
<p>Example of a user being denied due as the role <code>clusteradmin</code> wasn't setup.
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;T1001W&quot;</span><span class="p">,</span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;role clusteradmin is not found&quot;</span><span class="p">,</span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="s2">&quot;user.login&quot;</span><span class="p">,</span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;oidc&quot;</span><span class="p">,</span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="s2">&quot;2019-06-15T19:38:07Z&quot;</span><span class="p">,</span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="s2">&quot;cd9e45d0-b68c-43c3-87cf-73c4e0ec37e9&quot;</span><span class="p">}</span>
</code></pre></div></p>
<p>Some errors (like filesystem permissions or misconfigured network) can be
diagnosed using Teleport's <code>stderr</code> log, which is usually available via:</p>
<div class="highlight"><pre><span></span><code>$ sudo journalctl -fu teleport
</code></pre></div>
<p>If you wish to increase the verbosity of Teleport's syslog, you can pass the
<a href="../../../cli-docs/#teleport-start"><code>--debug</code></a> flag to <code>teleport start</code> command.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../ssh-adfs/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Active Directory (ADFS)
              </div>
            </div>
          </a>
        
        
          <a href="../ssh-one-login/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                OneLogin
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Gravitational Inc, 2016-20
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material-insiders/" target="_blank" rel="noopener">
            Material for MkDocs Insiders
          </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../../../assets/javascripts/bundle.d964fd3f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.0f64ce30.min.js"
          }, typeof search !== "undefined" && search),
          version: {'method': 'mike'}
        })
      </script>
      
        <script src="../../../js/version-select.js"></script>
      
    
  </body>
</html>